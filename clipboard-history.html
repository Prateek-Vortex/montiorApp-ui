<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Clipboard History</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      background: #18181b;
      color: #f3f3f7;
      height: 100vh;
      overflow: hidden;
    }
    .container {
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 300px;
      background: #23232a;
      border-right: 1px solid #23232a;
      display: flex;
      flex-direction: column;
    }
    .search-bar {
      padding: 20px 18px 14px 18px;
      background: #23232a;
      border-bottom: 1px solid #282832;
      box-shadow: 0 2px 8px #0003;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    .search-bar input {
      width: 100%;
      padding: 12px 14px;
      border-radius: 8px;
      border: 1px solid #35353f;
      background: #191920;
      color: #f3f3f7;
      font-size: 1em;
      outline: none;
      box-shadow: 0 1px 4px #0002;
      transition: border 0.2s;
    }
    .search-bar input:focus {
      border: 1.5px solid #7c3aed;
      background: #23232a;
    }
    .history-list {
      flex: 1;
      overflow-y: auto;
      padding: 0 0 10px 0;
      scrollbar-width: thin;
      scrollbar-color: #7c3aed #23232a;
    }
    .history-list::-webkit-scrollbar {
      width: 8px;
      background: #23232a;
    }
    .history-list::-webkit-scrollbar-thumb {
      background: #3a3a4a;
      border-radius: 6px;
    }
    .history-item {
      display: flex;
      align-items: center;
      padding: 10px 16px;
      cursor: pointer;
      border-left: 3px solid transparent;
      transition: background 0.15s, border-color 0.15s;
      background: none;
      min-height: 48px;
      border-bottom: 1px solid #23232a;
    }
    .history-item.selected, .history-item:hover {
      background: #23233a;
      border-left: 3px solid #7c3aed;
    }
    .item-icon {
      width: 28px;
      height: 28px;
      margin-right: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #23232a;
      border-radius: 6px;
      overflow: hidden;
      font-size: 1.1em;
    }
    .item-info {
      flex: 1;
      min-width: 0;
    }
    .item-content-preview {
      color: #f3f3f7;
      font-size: 0.98em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 1px;
    }
    .item-meta {
      color: #a1a1aa;
      font-size: 0.82em;
    }
    .main-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 36px 28px 0 28px;
      background: linear-gradient(120deg, #18181b 80%, #23232a 100%);
      min-width: 0;
    }
    .preview-box {
      width: 100%;
      max-width: 420px;
      min-height: 120px;
      background: #22222a;
      border-radius: 14px;
      box-shadow: 0 2px 16px #0003;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 28px;
      padding: 24px;
      overflow: auto;
      border: 1.5px solid #282832;
    }
    .preview-image {
      max-width: 100%;
      max-height: 180px;
      border-radius: 8px;
      background: #111;
      box-shadow: 0 2px 8px #0002;
    }
    .preview-text {
      color: #f3f3f7;
      font-size: 1.05em;
      word-break: break-word;
      white-space: pre-wrap;
      line-height: 1.5;
    }
    .meta-table {
      width: 100%;
      max-width: 420px;
      margin-bottom: 18px;
      border-collapse: separate;
      border-spacing: 0 2px;
      background: #1a1a22;
      border-radius: 8px;
      box-shadow: 0 1px 4px #0002;
    }
    .meta-table td {
      color: #a1a1aa;
      padding: 5px 10px;
      font-size: 0.97em;
    }
    .meta-table td.label {
      width: 100px;
      color: #7c3aed;
      font-weight: 500;
      padding-left: 16px;
    }
    .meta-table tr {
      border-bottom: 1px solid #23232a;
    }
    .copy-btn {
      background: linear-gradient(90deg, #7c3aed 0%, #6366f1 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 11px 28px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px #0002;
      transition: background 0.15s, transform 0.1s;
      margin-bottom: 8px;
    }
    .copy-btn:active {
      background: linear-gradient(90deg, #6366f1 0%, #7c3aed 100%);
      transform: scale(0.97);
    }
    .empty-state {
      color: #a1a1aa;
      text-align: center;
      margin-top: 60px;
      font-size: 1.05em;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <div class="search-bar">
        <input id="searchInput" type="text" placeholder="Type to filter entries..." autocomplete="off" />
      </div>
      <div class="history-list" id="historyList"></div>
    </div>
    <div class="main-panel">
      <div class="preview-box" id="previewBox"></div>
      <table class="meta-table" id="metaTable" style="display:none;"></table>
      <button class="copy-btn" id="copyBtn" style="display:none;">Copy to Clipboard</button>
      <div class="empty-state" id="emptyState" style="display:none;">No clipboard item selected</div>
    </div>
  </div>
  <script>
    let history = [];
    let filtered = [];
    let selectedIdx = 0;

    function renderList() {
      const list = document.getElementById('historyList');
      list.innerHTML = '';
      if (filtered.length === 0) {
        list.innerHTML = '<div class="empty-state">No clipboard entries found</div>';
        renderPreview(null);
        return;
      }
      filtered.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'history-item' + (idx === selectedIdx ? ' selected' : '');
        // Icon: image or text
        const icon = document.createElement('div');
        icon.className = 'item-icon';
        if (item.type === 'image') {
          const img = document.createElement('img');
          img.src = item.content;
          img.className = 'preview-image';
          img.style.maxWidth = '28px';
          img.style.maxHeight = '28px';
          icon.appendChild(img);
        } else {
          icon.textContent = '📝';
        }
        div.appendChild(icon);
        // Info
        const info = document.createElement('div');
        info.className = 'item-info';
        const preview = document.createElement('div');
        preview.className = 'item-content-preview';
        preview.textContent = item.type === 'image' ? '[Image]' : (item.content.length > 36 ? item.content.substring(0, 36) + '...' : item.content);
        info.appendChild(preview);
        const meta = document.createElement('div');
        meta.className = 'item-meta';
        meta.textContent = new Date(item.timestamp).toLocaleString();
        info.appendChild(meta);
        div.appendChild(info);
        div.onclick = () => selectItem(idx);
        list.appendChild(div);
      });
      renderPreview(filtered[selectedIdx] || null);
    }

    function renderPreview(item) {
      const previewBox = document.getElementById('previewBox');
      const metaTable = document.getElementById('metaTable');
      const copyBtn = document.getElementById('copyBtn');
      const emptyState = document.getElementById('emptyState');
      if (!item) {
        previewBox.innerHTML = '';
        metaTable.style.display = 'none';
        copyBtn.style.display = 'none';
        emptyState.style.display = '';
        return;
      }
      emptyState.style.display = 'none';
      // Preview
      if (item.type === 'image') {
        previewBox.innerHTML = `<img src="${item.content}" class="preview-image" />`;
      } else {
        previewBox.innerHTML = `<div class="preview-text">${escapeHtml(item.content)}</div>`;
      }
      // Metadata
      metaTable.innerHTML = `
        <tr><td class="label">Type</td><td>${item.type || 'text'}</td></tr>
        <tr><td class="label">Timestamp</td><td>${new Date(item.timestamp).toLocaleString()}</td></tr>
      `;
      metaTable.style.display = '';
      // Copy button
      copyBtn.style.display = '';
      copyBtn.onclick = () => {
        window.electronAPI.copyAndPasteClipboardItem(history.indexOf(item));
        window.close();
      };
    }

    function selectItem(idx) {
      selectedIdx = idx;
      renderList();
    }

    function escapeHtml(text) {
      if (!text) return '';
      return text.replace(/[&<>"']/g, function(m) {
        return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#039;'})[m];
      });
    }

    function filterHistory() {
      const q = document.getElementById('searchInput').value.toLowerCase();
      filtered = history.filter(item => {
        if (item.type === 'image') return '[image]'.includes(q);
        return item.content.toLowerCase().includes(q);
      });
      selectedIdx = 0;
      renderList();
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (filtered.length === 0) return;
      if (e.key === 'ArrowDown') {
        selectedIdx = (selectedIdx + 1) % filtered.length;
        renderList();
        e.preventDefault();
      } else if (e.key === 'ArrowUp') {
        selectedIdx = (selectedIdx - 1 + filtered.length) % filtered.length;
        renderList();
        e.preventDefault();
      } else if (e.key === 'Enter') {
        window.electronAPI.copyAndPasteClipboardItem(history.indexOf(filtered[selectedIdx]));
        window.close();
      } else if (e.key === 'Escape') {
        window.close();
      }
    });

    document.getElementById('searchInput').addEventListener('input', filterHistory);

    // Load history
    window.electronAPI.getClipboardHistory().then(h => {
      // Add type for compatibility (text only for now)
      history = h.map(item => ({ ...item, type: item.type || 'text' }));
      filtered = history.slice();
      renderList();
    });
  </script>
</body>
</html>
